function init(){setTimeout(function(){document.getElementsByTagName("header")[0].style.display="none"},3500),loadVars(),changeAnim(activeIndex),$newFile.addEventListener("change",function(){a.element.pause();var e=this.files[0];objURL=URL.createObjectURL(e),a.element.src=objURL}),$dropdown.addEventListener("change",function(){activeIndex=this.selectedIndex,changeAnim()}),$playButton.addEventListener("click",function(){a.element.play()})}function loadVars(){a.context=new(AudioContext||webkitAudioContext),a.element=document.getElementById("myAudio"),a.source=a.context.createMediaElementSource(a.element);var e=a.context.createAnalyser();e.smoothingTimeConstant=.85,a.analyser=e,a.source.connect(a.analyser),a.source.connect(a.context.destination),a.freqBin=new Uint8Array(a.analyser.frequencyBinCount),c.element=document.getElementById("myCanvas"),c.context=c.element.getContext("2d"),c.width=project.view.viewSize.width,c.height=project.view.viewSize.height,a.element.onplay=function(){$playButton.style.opacity=0,project.view.play()},a.element.onpause=function(){$playButton.style.opacity=1,project.view.pause()}}function changeAnim(){updateFeed(),project.activeLayer.removeChildren();var e;switch(activeIndex){case 0:e=9,a.analyser.fftSize=32;break;case 1:e=5,a.analyser.fftSize=32;break;case 2:e=16,a.analyser.fftSize=64;break;case 3:e=~~(c.width/100),a.analyser.fftSize=128;break;case 4:e=~~(c.width/50),a.analyser.fftSize=128}setUpCanvas(e)}function updateFeed(e,t){if(void 0!==e){a.analyser.getByteFrequencyData(a.freqBin);for(var n=void 0===t?0:t,i=0;e>i;i++)a.feed[i]=a.freqBin[i+n]}else a.feed=[]}function setUpCanvas(e){switch(activeIndex){case 0:for(var t=~~(c.width/e),a=0;e>a;a++){var n=new Point(a*t,.995*c.height),i=new Size(t-10,3),o=new Shape.Rectangle({point:n,size:i,fillColor:"black"});project.activeLayer.addChild(o)}break;case 1:for(var a=0;e>a;a++){var r=new Shape.Circle({center:view.center,radius:100-20*a,strokeColor:"black",strokeWidth:11-2*a});project.activeLayer.addChild(r)}break;case 2:for(var s=new Path({strokeColor:"black",strokeWidth:10,closed:!0}),d=[],a=0;e>a;a++){var h=a%2===0?60:50;d[a]=new Point(view.center.x-h*Math.cos(.39269915*a),view.center.y-h*Math.sin(.39269915*a))}s.addSegments(d),project.activeLayer.addChild(s.smooth());break;case 3:case 4:for(var s=new Path({strokeColor:"black",strokeWidth:10,strokeCap:"round"}),d=[[0,view.center.y]],l=~~((c.width-20)/e),a=1;e>a;a++)d[a]=new Point(l*a,view.center.y+20*Math.pow(-1,a));d.push([c.width,view.center.y]),s.addSegments(d),project.activeLayer.addChild(s.smooth())}}function onFrame(e){var t=project.activeLayer.children;switch(activeIndex){case 0:updateFeed(t.length,4);for(var n=0;n<t.length;n++)t[n].size.height=3+c.height*(a.feed[n]/150);break;case 1:updateFeed(t.length,5);for(var i=c.width/c.height>=1?c.height:c.width,n=0;n<t.length;n++)t[n].radius=(a.feed[n]/96+Math.pow(.5,n))*(.125-.024*n)*i+3*n;break;case 2:updateFeed(t[0].segments.length,6);var i=c.width/c.height>=1?c.height:c.width,o=0;for(var n in a.feed)o+=a.feed[n];o/=a.feed.length;for(var n=0;n<t[0].segments.length;n++){var r=(Math.pow(-1,n)*Math.pow(a.feed[n],2)*Math.log(a.feed[n]+1)/36e5+o/550)*i+30;t[0].segments[n].point.x=view.center.x-r*Math.cos(.39269915*n+e.count/400),t[0].segments[n].point.y=view.center.y-r*Math.sin(.39269915*n+e.count/400)}t[0].smooth();break;case 3:updateFeed(t[0].segments.length-1,9);for(var n=1;n<t[0].segments.length-1;n++)t[0].segments[n].point.y=view.center.y-Math.pow(-1,n)*((Math.sin(a.feed[n]/20)+1)/15*c.height+2);t[0].smooth();break;case 4:updateFeed(t[0].segments.length-1,5);for(var n=1;n<t[0].segments.length-1;n++)t[0].segments[n].point.y=view.center.y-Math.sin(a.feed[n]/20)/10*c.height;t[0].smooth()}}function onResize(){c.width=project.view.viewSize.width,c.height=project.view.viewSize.height,changeAnim()}var a=new Object,c=new Object,activeIndex=0,$newFile=document.getElementById("newFile"),$dropdown=document.getElementById("animation"),$playButton=document.querySelector(".canvas-container img");init();